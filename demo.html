<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GitHub Basics Audio Quiz</title>
    <style>
        :root {
            --primary: #2da44e; /* GitHub Green */
            --primary-hover: #2c974b;
            --dark: #0d1117;    /* GitHub Dark Bg */
            --card: #161b22;    /* GitHub Card Bg */
            --border: #30363d;
            --text: #c9d1d9;
            --accent: #58a6ff;
            --btn-bg: #21262d;
            --btn-border: rgba(240, 246, 252, 0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--dark);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
        }

        .container {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px 24px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .status-box {
            display: inline-block;
            background-color: rgba(56, 139, 253, 0.1);
            border: 1px solid rgba(56, 139, 253, 0.4);
            padding: 6px 16px;
            border-radius: 100px;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-area {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 120px;
        }

        .question-text {
            font-size: 1.3em;
            line-height: 1.5;
            margin-bottom: 12px;
            color: #ffffff;
            font-weight: 500;
        }

        .current-action {
            font-size: 1em;
            color: #8b949e;
            font-style: italic;
            margin-bottom: 30px;
            height: 24px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-top: auto;
            width: 100%;
        }

        button {
            background-color: var(--btn-bg);
            border: 1px solid var(--btn-border);
            color: var(--text);
            padding: 18px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.2s cubic-bezier(0.3, 0, 0.5, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        button:hover {
            background-color: #30363d;
            border-color: #8b949e;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        button.primary {
            background-color: var(--primary);
            color: white;
            border-color: rgba(240, 246, 252, 0.1);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
            flex: 1.2;
            font-size: 1.2em;
        }

        button.primary:hover {
            background-color: var(--primary-hover);
        }

        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 17, 23, 0.95);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        #start-overlay h2 {
            margin-bottom: 30px;
            color: white;
            font-size: 1.8em;
        }

        #start-overlay button {
            max-width: 300px;
            width: 100%;
            padding: 20px;
            font-size: 1.3em;
        }

        .progress-container {
            width: 100%;
            margin-top: 32px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #21262d;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.4s ease;
            box-shadow: 0 0 8px rgba(45, 164, 78, 0.4);
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }
            .container {
                padding: 24px 16px;
                min-height: 60vh;
            }
            .question-text {
                font-size: 1.1em;
            }
            .controls {
                gap: 8px;
            }
            button {
                padding: 16px 8px;
                font-size: 1em;
            }
            button.primary {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>

    <!-- Overlay for Browser Autoplay Policies -->
    <div id="start-overlay">
        <h2>Ready to Quiz?</h2>
        <button class="primary" onclick="startQuizManual()">Tap to Start</button>
    </div>

    <div class="container">
        <!-- The Small Box -->
        <div class="status-box">
            Question <span id="q-num">1</span> / 10
        </div>

        <!-- Visual Display of what's happening -->
        <div class="question-area">
            <div class="question-text" id="display-text">
                Waiting to start...
            </div>
            <div class="current-action" id="status-text">
                Press Start to begin
            </div>
        </div>

        <!-- Three Buttons -->
        <div class="controls">
            <button onclick="prevQuestion()">Previous</button>
            <button id="play-pause-btn" class="primary" onclick="togglePlay()">Pause</button>
            <button onclick="nextQuestion(true)">Next</button>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
        </div>
    </div>

    <script>
        // --- Data ---
        const quizData = [
            { 
                q: "GitHub is mainly used for:", 
                options: ["A) Database management", "B) Operating system development", "C) Version control and collaboration", "D) File compression"], 
                answer: "C", 
                explanation: "GitHub helps developers track code changes and collaborate using the Git version control system." 
            },
            { 
                q: "Which version control system is used by GitHub?", 
                options: ["A) Mercurial", "B) CVS", "C) SVN", "D) Git"], 
                answer: "D", 
                explanation: "GitHub is built on Git, a distributed version control system." 
            },
            { 
                q: "What is a GitHub repository?", 
                options: ["A) A storage space for a project", "B) git fork", "C) git push", "D) git pull"], 
                answer: "A", 
                explanation: "A repository stores files, folders, and the complete history of a project." 
            },
            { 
                q: "What is the function of git commit?", 
                options: ["A) Upload changes to GitHub", "B) Create a branch", "C) Save changes locally with a message", "D) Delete files"], 
                answer: "C", 
                explanation: "Git commit records changes in the local repository with a descriptive message." 
            },
            { 
                q: "Which GitHub file explains contribution guidelines?", 
                options: ["A) CONTRIBUTING.md", "B) INFO.md", "C) LICENSE", "D) README.md"], 
                answer: "A", 
                explanation: "CONTRIBUTING.md explains how others can contribute to the project." 
            },
            { 
                q: "Which protocol is commonly used to access GitHub repositories securely?", 
                options: ["A) FTP", "B) HTTP", "C) SMTP", "D) SSH"], 
                answer: "D", 
                explanation: "SSH provides encrypted and secure access using key-based authentication." 
            },
            { 
                q: "Which file specifies GitHub Actions workflows?", 
                options: ["A) workflow.md", "B) .github/workflows/*.yml", "C) config.json", "D) action.yml"], 
                answer: "B", 
                explanation: "GitHub Actions workflows are stored as YAML files inside the workflows folder." 
            },
            { 
                q: "GitHub is used only for storing files online.", 
                options: ["A) True", "B) False"], 
                answer: "B", 
                explanation: "GitHub also supports version control, collaboration, issue tracking, and automation." 
            },
            { 
                q: "A commit records changes made to files in the repository.", 
                options: ["A) True", "B) False"], 
                answer: "A", 
                explanation: "Each commit saves a snapshot of changes with author and time information." 
            },
            { 
                q: "Which GitHub feature helps manage tasks visually?", 
                options: ["A) Wiki", "B) Clone", "C) Projects", "D) Fork"], 
                answer: "C", 
                explanation: "GitHub Projects provides visual boards to manage tasks and issues." 
            }
        ];

        // --- Logic ---
        let currentIdx = 0;
        let isPlaying = false;
        let synth = window.speechSynthesis;
        let utterance = null;
        let voices = [];
        let completed = false;

        // Elements
        const qNumEl = document.getElementById('q-num');
        const displayTextEl = document.getElementById('display-text');
        const statusTextEl = document.getElementById('status-text');
        const playBtnEl = document.getElementById('play-pause-btn');
        const progressEl = document.getElementById('progress');
        const overlay = document.getElementById('start-overlay');

        // Initialize Voices
        function loadVoices() {
            voices = synth.getVoices();
        }
        
        loadVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        // On Load
        window.onload = function() {
            updateUI();
            // Force user interaction to avoid audio policy errors
            overlay.style.display = 'flex';
        };

        function startQuizManual() {
            overlay.style.display = "none";
            // Resume if paused, or start over
            if (synth.paused) {
                synth.resume();
            } else {
                startQuizLogic();
            }
            isPlaying = true;
            updatePlayButton();
        }

        function startQuizLogic() {
            if (completed) {
                currentIdx = 0;
                completed = false;
            }
            playSequence(currentIdx);
        }

        function playSequence(index, announceTransition = false) {
            if (index >= quizData.length) {
                finishQuiz();
                return;
            }

            cancelSpeech();
            isPlaying = true;
            updateUI();

            const q = quizData[index];
            const qNum = index + 1;

            const part1 = `Question ${qNum}. ${q.q}`;
            const part2 = `${q.options.join(". ")}`;
            const part3 = `The correct answer is ${q.answer}. Explanation: ${q.explanation}`;

            // Small delay to ensure cancel() finished in browser engine
            setTimeout(() => {
                if(!isPlaying) return;
                
                // Helper function to start reading the question proper
                const startReading = () => {
                     speakText(part1, "Reading Question...", () => {
                        if(!isPlaying) return;
                        speakText(part2, "Reading Options...", () => {
                            if(!isPlaying) return;
                            setTimeout(() => {
                                if(!isPlaying) return;
                                speakText(part3, "Explaining Answer...", () => {
                                    if(!isPlaying) return;
                                    setTimeout(() => {
                                        if(isPlaying) nextQuestion(false); // Auto advance is NOT manual
                                    }, 1000);
                                });
                            }, 500);
                        });
                    });
                };

                if (announceTransition) {
                    // Speak transition phrase first at 1.5x speed
                    speakText(`Switched to question number ${qNum}`, `Switched to Q${qNum}`, () => {
                         if(!isPlaying) return;
                         startReading();
                    }, 1.5);
                } else {
                    startReading();
                }

            }, 50);
        }

        function speakText(text, statusMsg, onEndCallback, rate = 1.0) {
            if (!isPlaying) return;

            statusTextEl.innerText = statusMsg;
            displayTextEl.innerText = text;

            // Create new utterance
            let u = new SpeechSynthesisUtterance(text);
            u.rate = rate; // Use the provided rate (defaults to 1.0)
            u.pitch = 1.0;
            
            // Try to set voice if available
            if (voices.length > 0) {
                const preferredVoice = voices.find(v => v.name.includes("Google US English") || v.name.includes("Samantha"));
                if (preferredVoice) u.voice = preferredVoice;
            }

            // Events
            u.onend = () => {
                if (onEndCallback) onEndCallback();
            };

            u.onerror = (e) => {
                console.error("Speech error", e);
                // If it was canceled intentionally, ignore. 
                // If it was a real error (like network or policy), stop playing
                if (e.error !== 'canceled' && e.error !== 'interrupted') {
                     isPlaying = false;
                     statusTextEl.innerText = "Error playing audio. Press Next.";
                     updatePlayButton();
                }
            };

            // Global ref to prevent GC
            utterance = u; 
            synth.speak(u);
        }

        function cancelSpeech() {
            synth.cancel();
        }

        function togglePlay() {
            if (isPlaying) {
                // Pause
                isPlaying = false;
                synth.cancel(); 
                statusTextEl.innerText = "Paused";
            } else {
                // Resume
                isPlaying = true;
                playSequence(currentIdx, false); // No transition announcement on resume
            }
            updatePlayButton();
        }

        function nextQuestion(isManual = false) {
            if (currentIdx < quizData.length) {
                 if (currentIdx + 1 >= quizData.length) {
                     finishQuiz();
                     return;
                 }
                currentIdx++;
                playSequence(currentIdx, isManual);
            }
        }

        function prevQuestion() {
            if (currentIdx > 0) {
                currentIdx--;
                playSequence(currentIdx, true); // Always manual/transition
            }
        }

        function finishQuiz() {
            completed = true;
            isPlaying = false;
            updateUI();
            displayTextEl.innerText = "Congratulations! You have completed the quiz.";
            statusTextEl.innerText = "Finished";
            speakText("Congratulations! You have completed the quiz.", "Finished", null);
            updatePlayButton();
        }

        function updateUI() {
            qNumEl.innerText = (currentIdx + 1 > quizData.length) ? quizData.length : currentIdx + 1;
            
            const percent = ((currentIdx) / quizData.length) * 100;
            progressEl.style.width = `${percent}%`;

            updatePlayButton();
        }

        function updatePlayButton() {
            playBtnEl.innerText = isPlaying ? "Pause" : "Play";
            playBtnEl.classList.toggle('primary', !isPlaying);
            if(isPlaying) {
                playBtnEl.style.backgroundColor = "#d73a49";
                playBtnEl.style.borderColor = "#d73a49";
            } else {
                playBtnEl.style.backgroundColor = "";
                playBtnEl.style.borderColor = "";
            }
        }

    </script>
</body>
</html>
